(function(e){function t(t){for(var r,a,i=t[0],l=t[1],c=t[2],d=0,h=[];d<i.length;d++)a=i[d],o[a]&&h.push(o[a][0]),o[a]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(h.length)h.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],r=!0,i=1;i<s.length;i++){var l=s[i];0!==o[l]&&(r=!1)}r&&(n.splice(t--,1),e=a(a.s=s[0]))}return e}var r={},o={app:0},n=[];function a(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=r,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/testTags/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var u=l;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var r=s("64a9"),o=s.n(r);o.a},"0546":function(e,t,s){},"17b2":function(e,t,s){e.exports=s.p+"img/price-tag.9c020d07.svg"},3004:function(e,t,s){"use strict";var r=s("0546"),o=s.n(r);o.a},"355a":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var r=s("2b0e"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"clearfix bg-blue banner-full-screen u-pbl",attrs:{id:"app"}},[s("header",[s("lhHeader",{attrs:{content:e.content},on:{stepUpdate:function(t){e.moveToSection(t)}}})],1),s("lhTable",{directives:[{name:"show",rawName:"v-show",value:e.visibleSection.includes("table"),expression:"visibleSection.includes('table')"}],staticClass:"why u-mtl u-mbl u-pbl u-txtCenter",attrs:{content:e.content,id:"table"},on:{stepUpdate:function(t){e.moveToSection(t)}}}),s("lhResults",{directives:[{name:"show",rawName:"v-show",value:e.visibleSection.includes("results"),expression:"visibleSection.includes('results')"}],staticClass:"why u-mtl u-mbl u-pbl u-txtCenter",attrs:{content:e.content,id:"results"},on:{stepUpdate:function(t){e.moveToSection(t)}}})],1)},n=[],a=(s("355a"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("img",{staticClass:"img-center img-responsive u-mtm u-sm-mtm",attrs:{src:s("17b2"),width:"200px",alt:""}}),r("h1",{staticClass:"u-txtCenter u-mts"},[e._v(" Lighthouse tag tester")]),r("p",{staticClass:"u-txtCenter u-txtcatchline"},[e._v("Check how much the tags affect performance ")]),r("div",{staticClass:"form-group"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],staticClass:"form-input block-center",attrs:{id:"url",placeholder:"Fill in a web-address (URL)",type:"url"},domProps:{value:e.url},on:{input:function(t){t.target.composing||(e.url=t.target.value)}}})]),r("button",{staticClass:"block-center button button--big u-plm u-prm u-sm-pln u-sm-prn",attrs:{href:"#",id:"submitFeedback",disabled:e.isLoading},on:{click:function(t){return t.preventDefault(),e.sendUrl(t)}}},[e._v("Detect\n        third party tags")]),r("p",{directives:[{name:"show",rawName:"v-show",value:!1===e.urlValid,expression:"urlValid === false"}],staticClass:"ab-error u-txtCenter"},[e._v("Please enter a valid url")]),r("p",{directives:[{name:"show",rawName:"v-show",value:""!==e.error.message,expression:"error.message !== ''"}],staticClass:"ab-error u-txtCenter"},[e._v(e._s(e.error.message))]),r("section",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}],staticClass:"loading"},[r("v-progress-circular",{staticClass:"u-mtm block-center",attrs:{size:50,color:"amber",indeterminate:""}}),r("p",{staticClass:"u-txtCenter"},[e._v("We are detecting the tags on "+e._s(e.url)+"... this can take a bit of\n            time\n            especially if the tested page is slow")])],1)])}),i=[],l=s("69b4"),c={name:"lh-header",props:["content"],data(){return{url:"",urlValid:null,isLoading:!1,error:{message:""}}},methods:{sendUrl:function(){console.log(Object({VUE_APP_API_LIGHTHOUSE:"http://antoineb.c.googlers.com/lighthouse/",VUE_APP_API_PUPPETEER:"http://antoineb.c.googlers.com/puppeteer/",NODE_ENV:"production",BASE_URL:"/testTags/"})),this.error.message="",this.urlValid=!!this.$validator.isURL(this.url),this.urlValid&&(userInfo.url=this.url,this.runOriginalTest().then(e=>console.log(e)).catch(e=>{console.log(e),Object(l["captureException"])(e)}),this.getThirdParty().then(e=>{this.isLoading=!1,$.$emit("tagsDetected",e),this.$emit("stepUpdate","table")}).catch(e=>{if(Object(l["captureException"])(e),this.isLoading=!1,e=e.toString(),e.includes("ERR_NAME_NOT_RESOLVED"))return this.error.message="Can't access this url, this domain doesn't exist";this.error.message=e}))},async runOriginalTest(){},async getThirdParty(){this.isLoading=!0;const e=await fetch(`http://antoineb.c.googlers.com/puppeteer//get3p?url=${this.url}`);if(!e.ok)throw new Error(await e.text());const{body:t,ok:s,error:r}=await e.json();if(!s)throw new Error(r);if(t.shouldntBeBlocked.includes("datadome.co"))throw new Error("The tool has been blocked by the website... nothing we can do about it... sorry");return t}}},u=c,d=(s("3004"),s("2877")),h=Object(d["a"])(u,a,i,!1,null,null,null);h.options.__file="header.vue";var p=h.exports,g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h2",{staticClass:"u-mtl u-mbm u-sm-mts u-sm-mbs"},[e._v(" which tags do you want to block ? ")]),s("p",[e._v(" We already selected marketing tags, but we maybe missed some, feel free to customize the blocking list ")]),s("div",{staticClass:"row u-mtm"},[s("v-app",{staticClass:"tags-table",attrs:{id:"inspire"}},[s("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.tags,"item-key":"name","disable-initial-sort":!0,"hide-actions":""},scopedSlots:e._u([{key:"items",fn:function(t){return[s("td",{staticClass:"checkbox-small"},[s("v-checkbox",{attrs:{"input-value":e.isSelected(t.item),primary:"","hide-details":""},on:{change:function(s){e.toggle(t.item)}}})],1),s("td",[e._v(e._s(t.item.url))])]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}})],1),s("button",{staticClass:"block-center button button--big u-plm u-prm u-sm-pln u-sm-prn u-mtm",attrs:{disabled:e.isLoading},on:{click:function(t){return t.preventDefault(),e.selectTags(t)}}},[e._v(e._s(e.getAlternateLabel()))]),s("section",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}],staticClass:"loading"},[s("v-progress-circular",{staticClass:"u-mtm block-center",attrs:{size:50,color:"amber",indeterminate:""}}),s("p",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}],staticClass:"u-txtCenter"},[e._m(0)]),s("p",{directives:[{name:"show",rawName:"v-show",value:""!==e.error.message,expression:"error.message !== ''"}],staticClass:"ab-error u-txtCenter"},[e._v(e._s(e.error.message))])],1)],1)])},m=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("strong",[e._v("Please wait ! We are running 2 LightHouse reports\n                    for\n                    the site. "),s("br"),e._v(" It can take a bit of time especially if the site is slow")])}],f={name:"lh-table",props:["content"],data:()=>({selected:[],tags:[],isLoading:!1,error:{message:""},headers:[{text:"Tag to be blocked",value:"shouldBeBlocked"},{text:"Url",value:"url",align:"center"}]}),methods:{onSelect(e){this.selected=e},getAlternateLabel(e){let t="";return this.selected.length>1&&(t="s"),`Block ${this.selected.length} tag${t}`},isSelected(e){return!!this.selected.includes(e)},toggle(e){this.selected.includes(e)?(this.selected=this.selected.filter(t=>t!==e),console.log("THE NEW VALUE",this.selected)):this.selected.push(e)},toggleAll(){console.log("TOGLE ALL"),this.selected.length?this.selected=[]:this.selected=this.tags.slice()},changeSort(e){this.pagination.sortBy===e?this.pagination.descending=!this.pagination.descending:(this.pagination.sortBy=e,this.pagination.descending=!1)},selectTags(){this.isLoading=!0,this.runTest().then(e=>{return this.isLoading=!1,e.blockedTestResult.ok?e.originalTestResult.ok?(this.$emit("stepUpdate","results"),void setTimeout(()=>{$.$emit("reportsReady",e),$.$emit("blockedTags",this.selected)},800)):(this.error.message="Something wrong happened with original LightHouse test... See message in the JavaScript console",void console.log(e.originalTestResult.message)):(this.error.message="Something wrong happened with the blocked test... See message in the JavaScript console",void console.log(e.blockedTestResult.message))}).catch(e=>{this.isLoading=!1,Object(l["captureException"])(e),this.error.message="Something wrong happened with original LightHouse test... See message in the JavaScript console",console.log(e)})},async runTest(){const e=await fetch("http://antoineb.c.googlers.com/lighthouse//runtest",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:userInfo.url,blockedRequests:this.selected.map(e=>e.url)})});if(!e.ok){const t=await e.text();throw new Error(t)}const{body:t,ok:s,error:r}=await e.json();if(!s)throw new Error(r);return t}},created(){$.$on("tagsDetected",e=>{const t=e.shouldntBeBlocked.map(e=>{return{url:e,shouldBeBlocked:!1}}),s=e.shouldBeBlocked.map(e=>{return{url:e,shouldBeBlocked:!0}});this.tags=s.concat(t),this.selected=s})}},b=f,v=(s("ec00"),Object(d["a"])(b,g,m,!1,null,null,null));v.options.__file="table.vue";var _=v.exports,w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container-results"},[s("h2",{staticClass:"u-mtl u-mbm u-sm-mts u-sm-mbs"},[e._v(" Results ")]),s("section",{staticClass:"res-header"},[e._m(0),s("div",[s("h3",[e._v("No tags ")]),e.blockedTags?s("p",{staticClass:"tags"},[e._v(e._s(e.blockedTags))]):e._e()])]),e.result.originalTestResult?s("iframe",{attrs:{src:e.VUE_APP_API_LIGHTHOUSE+"/report/?report="+e.result.originalTestResult.report}}):e._e(),e.result.blockedTestResult?s("iframe",{attrs:{src:e.VUE_APP_API_LIGHTHOUSE+"/report/?report="+e.result.blockedTestResult.report}}):e._e()])},T=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("h3",[e._v("With Tags")]),s("p",[e._v("We cached this test for 60min")])])}],E={name:"lh-results",props:["content"],data:()=>({result:{},blockedTags:!1,VUE_APP_API_LIGHTHOUSE:null}),methods:{async getJSONdata(e){const t=await fetch(`${Object({VUE_APP_API_LIGHTHOUSE:"http://antoineb.c.googlers.com/lighthouse/",VUE_APP_API_PUPPETEER:"http://antoineb.c.googlers.com/puppeteer/",NODE_ENV:"production",BASE_URL:"/testTags/"}).VUE_APP_LIGHTHOUSE_ENDPOINT}/index.php?path=${e}`);if(!t.ok){const e=await t.text();throw new Error(e)}const s=await t.json();return s},async compare(){const e=this.getJSONdata(this.result.originalTestResult.reportJSON),t=this.getJSONdata(this.result.blockedTestResult.reportJSON),[s,r]=await Promise.all([e,t]);console.log(s.categories.performance.score),console.log(r.categories.performance.score)}},created(){$.$on("reportsReady",e=>{this.result=e,this.VUE_APP_API_LIGHTHOUSE="http://antoineb.c.googlers.com/lighthouse/"}),$.$on("blockedTags",e=>{this.blockedTags=e.map(e=>e.url).join(" ")})}},k=E,y=(s("9357"),Object(d["a"])(k,w,T,!1,null,null,null));y.options.__file="results.vue";var S=y.exports,x={name:"app",components:{lhHeader:p,lhTable:_,lhResults:S},data(){return{content:"",visibleSection:[]}},methods:{moveToSection:function(e){this.visibleSection.push(e),this.scrollTo("#"+e)},scrollTo:function(e){setTimeout(()=>{this.$scrollTo(e,500)},100)}}},P=x,C=(s("034f"),Object(d["a"])(P,o,n,!1,null,null,null));C.options.__file="App.vue";var O=C.exports,L=s("ce5b"),U=s.n(L);s("bf40");s.d(t,"serverBus",function(){return $}),Object(l["init"])({dsn:"https://a263e28c22fa4fe4b3b9b050b62e3688@sentry.io/1330525"}),r["default"].use(U.a),r["default"].prototype.$validator=s("f90c"),r["default"].config.productionTip=!1,r["default"].prototype.$userInfo={},r["default"].prototype.$userInfo.firstName="",r["default"].prototype.$userInfo.email="",r["default"].prototype.$steps={},window.userInfo={};const $=new r["default"];var A=s("f13c");r["default"].use(A),new r["default"]({render:function(e){return e(O)}}).$mount("#app")},"64a9":function(e,t,s){},"6dff":function(e,t,s){},9357:function(e,t,s){"use strict";var r=s("af41"),o=s.n(r);o.a},af41:function(e,t,s){},ec00:function(e,t,s){"use strict";var r=s("6dff"),o=s.n(r);o.a}});
//# sourceMappingURL=app.24da70a3.js.map